#!/usr/bin/env python3

"""Usage:

    config_check.py <path>
"""
import os
import sys
import pyfiglet
import termcolor
os.system("color")
import logging
from logging.handlers import RotatingFileHandler
import webbrowser
import time
import socket
import json

myhost = socket.gethostname()

def resource_path(relative_path):
    """ Get absolute path to resource, works for dev and for PyInstaller """
    base_path = getattr(sys, '_MEIPASS', os.path.dirname(os.path.abspath(__file__)))
    return os.path.join(base_path, relative_path)


# logging setup
rfh = logging.handlers.RotatingFileHandler(

    filename=resource_path('C:/config_check/'+myhost+"_test_result.txt"),
    mode='a',
    maxBytes=5*1024*1024,
    backupCount=2,
    encoding=None,
    delay=0

)
logging.basicConfig(
    level=logging.DEBUG,
    format="%(asctime)s %(name)-25s %(levelname)-8s %(message)s",
    datefmt="%y-%m-%d %H:%M:%S",
    handlers=[
        rfh
    ]
)

logger = logging.getLogger('main')


def easter_egg(path):

    YEAH = """,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ........................................................................................................................
    ........................................................................................................................
    .................................................,,,,,,.................................................................
    ............................................,,:;;+;;;;?;;;;::::,........................................................
    ..........................................:+;:::::,...:+,:;;,,+++:......................................................
    .........................................++;.....:;*;:,;,.:+.;;;,;;.....................................................
    ........................................+;+....,*?:;,,:,:.,+;@#+..;;....................................................
    ......................................,+:.,,..,#@@;...,;..;:?$:..:;+,...................................................
    ......................................+:...,,.:#@@:....+.::..*;..:;*;...................................................
    .....................................,*...,;,,,;$$;::,:+,,....:;;;::+,..................................................
    .....................................:*:;;*+*?%$$$#$$$%?+;::::,++,,:*,..................................................
    ...................................,+*%##@@@@@@@@@@@@@@@@;.,**?%#%*:+,..................................................
    ...................................;?@@@@@@@#$#@@@@@@@@@@%,,?$@@@@@#,...................................................
    ...................................++@@@@@@%+;+%@@@@@@@@$?;:#@@@@@@@*+;;;;;,,...........................................
    .................,::::::;:,........;+$@@@@@++.,;+%#@#$?+;:,.$@@@@@@@@@@@@@@@##$+,.......................................
    .................:,,,,,,::+.........:+%$##%?,..,;;:;;::,....%@@@@@@@@@@@@@@@@@@@$;......................................
    ...............::::*+?*+::,,,........:$%:;+?:,,;;+;;+:,.....%@@@@@@@@@@@@@@@@@@@@@,.....................................
    .............,+:,,.,,:,,,..,::,....,+#@@:.;?%?????%%%$?+,..;#@@@@@@@@@@@@@@@@@@@@@%:....................................
    .............:+..,+;:,:;;*+,.,++++:?@@@@#:?#?+;;;*?$%;*;,?#@@@@@@@@@@@@@@@@@@@@@@@@@:...................................
    ............,*:,.:;*+,...,+$*,;*;*+#@@@@@%%,%*??**+;;,+?;@@@@*?@@@@@@@@@@@@%??%$$###$+::,...............................
    ...........:+,,;;.?+.......:@*,..;?@@@@@@@#,.,:;;;,..,$@@@@@+,:+%@@@@@@@#?:......,,,,::;;;;:,...........................
    ...........,+,:;+:*.........$$:,,*;*@@@@@@@%;+?$$*::*#@@@@#+;;,.,**++**;,.......,,........,:++:.........................
    ............;;;;:;,.......:+;:+;;;,.*#@@@@@@@@@@@@@@@@@@@%+;;,..+*,............::............,;+:.......................
    ...........,+?,.,....;*;;+;,......:+;;#@@@@@@@@@@@@@@@@$*;;:,..+*,............;:...............,++,.....................
    ...........;*,*;,..,;#$?;.......:+;,..;##@%+?$#@@@@@#%+;;:,..,+*,............;;..................:*;....................
    ..........,*:,,;++*??;.+;......+*,......,+;:..,++;::,,:::,..,++,............:+....................,;+:..................
    ..........:*.,:::::,..:*.....,*;,,..,,...,.....:+;;;;;;;,..:+;,........,:...+,......................,*;.................
    ..........+;....,:::,,:*....:*:+;,.,:;,.........*%:,,,....:+;...........;..,+....:,...................++,...............
    .........,?,,,:,,,::;,;+...:*,.:+:.,+;..........,?;:,...,;*;............;:.:;:,.:;...,,................:*;..............
    .........,%,..,,::;;:.?,,:+?;:::,,.:*............:?,...:*;,,,,.....,,...,+,,:;:,+,..,;,.........,........;+,............
    .........?@%+::,,,,::+*;+:,,:;**+:,??.............:*;:;+:..,::;:,...:;:,.,+,.:;;+..:;:,.....,:::,..,,,...,+%;...........
    ........+@;,;+***++;;%+,.......;$?;#+..............,:;:,......,,;;:,..:;,::;,,*++:,+;:,:..:;;:,..,,,,:+?%?*+*;..........
    .......,#;..........:+..........,$@#,............................,:;;:,,.,:;;:;+*+;+;;:,:;;,.....,;*%%*;,...,*:.........
    .......?*...........:*...........:@$................................,:;;;::;;+:,++:?;,,;:,.....:?#$*:........,?,........
    ......:$,...........,*:...........##,...................................,,:::++;$?;;..:,....:*$@$;,...........++........
    ......*?.............,:.........:*##:.........................................;$@#:.......;?#@%:..............,*........
    ......,;?%???????;:*????,+??%?+;%%%%???%%:.......,;*%%?*;;.*???????*:..:???????$$+,...,*%?;::,..+?%?+....;?%?+.,........
    ......,@@$$@@@$$@@;%@@@?,;@@@@;:%@@@+;*?#+......+#@@??%@@@+;@@@#+#@@@;.,?@@@*;+*#?....+@@@#;....;#@@@?..+@@@@;..........
    ......,+;.*@@@;.++.+@@@%**@@@$..+@@@+*@;,......+@@@?...:%$;.#@@$;$@@$:..:@@@*+@+,....,#$%@@@+....%@@@@?*@@@@$...........
    ..........?@@@+....+@@@$??@@@$..+@@@?%@;.,.....*@@@#:....,..#@@@%@@@%;..:@@@%?@*.,..,$@?+#@@@+...$@?#@@@%#@@$...........
    .........,$@@@*,..,?@@@+.,#@@#,.*@@@;,;:?#:....,%@@@@%**%#:,#@@#.+@@@#:.+@@@+,;:*@;,$@$?%%@@@@+,,#@:;@@%,$@@#,..........
    .........?$###$+..;$###%,?####+;$$$$$%%$#?.......;?$###$?;.?###$+.?#@@%;%$$$$%%$#%;%##?..;$####+*##?.;?.;###$*..........
    ....,;*??*;:.,,***+*****;.,,,.,***+++***:,++**+,:+***+;++++***??:..,,,...:+*??+;:.+*******+:,,,.,:+??*+:..,;++++***;,...
    ..,?#@#%#@@#*,,*@@@#**?#@:...,#@##@@@##@@;$@@@%,;@@@@+:%@@@?+*?@*......;$@@$%$@@@++@@@@*#@@@;..:$@@$$@@@$;.;$@@@*?@@@+..
    ..?@@@:.,%@@@%.,@@@$;%?,:,...,**,+@@@+,**,;@@@?++#@@#..;@@@;+#;,,.....;@@@%...;$#+.$@@$:$@@#;.:@@@%..;@@@@;.*@@@:,#@@%..
    ..#@@@*..:@@@@,,@@@#%@#..........*@@@+....+@@@#%%@@@$..;@@@%$@+.......+@@@#,....,..$@@@$@@@%:.;@@@#,..?@@@*.*@@@$##$?,..
    ..+@@@@*:+@@@*.:@@@%.+;.........,?@@@*,...*@@@+..#@@#,.+@@@;,+:*#:....,$@@@#*++?$:,#@@#.*@@@#,,%@@@$;:%@@$:.*@@@;,,.....
    ...:?#@@@@$?:.:$@@@#?..........,?#@@@#*..;#@@@$:*@@@#*:$@@@$%%$@%,.....,+%#@@@#$*,?@@@@*,%@@@$,.+%#@@##%+,.;$@@@%,......
    ......,::,.....,,:,,,...........,,,,,,,...,,,,,.,,,,,,,,,,,,,,,,..........,,:,,...,,::,,..,::,....,,:,,.....,,,,,.......
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ........................................................................................................................
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,"""

    if path == "YEAH":
        print("I'VE BEEN TO THE TOP OF THE MOUNTAIN")
        webbrowser.open('https://google.com')
        time.sleep(3)
        print("YEAAAAAHHHHH")
        webbrowser.open('https://youtu.be/_bLRaGo-Qwc?t=58')
        time.sleep(2)
        print("BECAUSE I'M WILD OOOOHHHHHHHHHH YEAAAH")
        time.sleep(3)
        print("YOUUUUU DONN'T KNOW WHERRRREE THE MAAACHOOOO MANNNN IS COMING FROMMMMMMMM")
        time.sleep(2)
        print("SNAP INTO A SLIM JIM YEEAAHHHH")
        time.sleep(2)
        print(YEAH)
        input("Press any key to exit")


def string_search(path, string):
    """Find a string in a path and print out some info about what it found"""
    with open(path, "r") as f:
        found = False
        for line in f.readlines():
            if str(string) in line:
                found = True
                print(termcolor.colored("Found:", "green"))
                logger.debug("Found:")
                print(termcolor.colored(f"{line}", "green"))
                logger.debug(f"{line}")
                break
        if not found:
            print(termcolor.colored('Not Found:', 'red'))
            logger.debug("ERROR Not Found:")
            print(termcolor.colored(f'{string} not found\n', 'red'))
            logger.debug(f"{string}\n")



def main():

    ### Title ###
    header = pyfiglet.figlet_format("DIRECTORY SEARCHER 3000", font = "slant")
    header = termcolor.colored(header, color="magenta")
    print(header)

    #
    # Start of actual implementation
    #

    ### Specify path and extension to search ###
    if len(sys.argv) != 2:
        print('Script expects 1 argument')
    
    path = sys.argv[1] # input("Specify directory path ")
    ### useless easter egg ###
    easter_egg(path)
   
    # Do some error checking

    if not os.path.isfile(path):
        print(f"'{path}' is not a valid file")
        exit(1)

    split_path = path.split('.')

    if len(split_path) != 2:
        print(f"'{path}' does not have a valid file extension")
        exit(1)
    
    ext = split_path[1]

    if ext != 'ini':
        print(f"'{path}' is not a .ini file")
        exit(1)

    ### Logic on searching files for specified string, was not able to get this to loop successfully ###      
    string = ''  
    print(termcolor.colored(myhost, "magenta"))
    logger.debug(myhost)
    print(termcolor.colored("\nFile: web.ini", "magenta"))
    logger.debug("***SEARCH: web.ini***\n")
    # string_search(path, "ApacheVersion=2.4.41")
    # string_search(path, "LogActiveDirectoryLogins=0")
    # string_search(path, "ReleaseVersion=Quantify5B_Build_59")
    # string_search(path, "RestrictAlarmDisplay=1")
    # string_search(path, "HijackingProtection=0")
    # string_search(path, "LOGINEXPIRY=1800")
    # string_search(path, "DefaultLocale=US")
    # string_search(path, "AllowLocalStorage=0")
    # string_search(path, "UseEngineerAccount=0")
    # string_search(path, "HTML5Replay=1")
    # string_search(path, "PerformBrowserChecks=0")
    # string_search(path, "USE_LDS=1")

    with open("c:/config_check/config/config.json") as json_file:
        data = json.load(json_file)
    ApacheVersion = (data['JPMC']['web']['1'])
    LogActiveDirectoryLogins = (data['JPMC']['web']['2'])
    ReleaseVersion = (data['JPMC']['web']['3'])
    RestrictAlarmDisplay = (data['JPMC']['web']['4'])
    HijackingProtection = (data['JPMC']['web']['5'])
    LOGINEXPIRY = (data['JPMC']['web']['6'])
    DefaultLocale = (data['JPMC']['web']['7'])
    AllowLocalStorage = (data['JPMC']['web']['8'])
    UseEngineerAccount = (data['JPMC']['web']['9'])
    HTML5Replay = (data['JPMC']['web']['10'])
    PerformBrowserChecks = (data['JPMC']['web']['11'])
    USE_LDS = (data['JPMC']['web']['12'])

    string_search(path, ApacheVersion)
    string_search(path, LogActiveDirectoryLogins)
    string_search(path, ReleaseVersion)
    string_search(path, RestrictAlarmDisplay)
    string_search(path, HijackingProtection)
    string_search(path, LOGINEXPIRY)
    string_search(path, DefaultLocale)
    string_search(path, AllowLocalStorage)
    string_search(path, UseEngineerAccount)
    string_search(path, HTML5Replay)
    string_search(path, PerformBrowserChecks)
    string_search(path, USE_LDS)
    




if __name__ == '__main__':
    main()